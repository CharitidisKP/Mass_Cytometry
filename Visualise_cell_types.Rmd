```{r}

library(tidyverse)
library(Seurat)
library(Matrix)


```

```{r}

Meta <- read.csv("~/Downloads/1k_metadata.csv", row.names = 1, stringsAsFactors = FALSE)
Raw_Counts <- read.csv("~/Downloads/1k_rawcount_exprMatrix.csv", row.names = 1, stringsAsFactors = FALSE)

Counts_Sparse <- Matrix(as.matrix(Raw_Counts), sparse = TRUE) %>% 
  t()

dim(Counts_Sparse)

Common_samples <- intersect(colnames(Counts_Sparse), rownames(Meta))
Counts_Sparse <- Counts_Sparse[ , Common_samples]

common_cells <- intersect(colnames(Counts_Sparse), rownames(Meta))

Meta <- Meta[Common_samples, , drop = FALSE]
Meta <- Meta[colnames(Counts_Sparse), , drop = FALSE]

Seu_1K <- CreateSeuratObject(counts = Counts_Sparse, meta.data = Meta, assay = "Spatial", project = "3TR")


```

```{r}

pbmc.data <- Read10X(data.dir = "~/Downloads/filtered_gene_bc_matrices/hg19/")
pbmc <- CreateSeuratObject(counts = pbmc.data, project = "pbmc3k", min.cells = 3, min.features = 200)

```


```{r}

Slide_1_f1 <- Meta %>% 
  # select(fov, slide_ID_numeric) %>% 
  filter(fov == 1, slide_ID_numeric == 1) 

VlnPlot(Seu_1K,
        features = c("nFeature_Spatial", "nCount_Spatial", "percent.mt"),
        ncol = 3, pt.size = 0)

Seu_1K <- FindVariableFeatures(Seu_1K, selection.method = "vst", nfeatures = 2000)
top_10 <- head(VariableFeatures(Seu_1K), 10)

VF_plot <- VariableFeaturePlot(Seu_1K)

VariableFeaturePlot(Seu_1K) +
  LabelPoints(plot = VF_plot, points = top_10, repel = TRUE)

Meta %>% 
  mutate(xaxis = x_FOV_px * fov, 
         yaxis = y_FOV_px * fov) %>% 
  filter(fov %in% c(1, 2)) %>% 
  ggplot(.) +
  geom_point(aes(x = xaxis, y = yaxis, colour = RNA_Export_Cell.Typing.InSituType.2_1_clusters)) +
  coord_fixed()

```

